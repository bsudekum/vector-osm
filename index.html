<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0"/>
  <title>Vector OSM</title>
  <link href='style.css' rel='stylesheet' />
  <script src='http://api.tiles.mapbox.com/mapbox.js/v1.0.2/mapbox.js'></script>
  <link href='http://api.tiles.mapbox.com/mapbox.js/v1.0.2/mapbox.css' rel='stylesheet' />
  <!--[if lte IE 8]>
    <link href='http://api.tiles.mapbox.com/mapbox.js/v1.0.2/mapbox.ie.css' rel='stylesheet' >
  <![endif]-->
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="tilejson.js"></script>
  <script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
  <script src="foursquare.js"></script>
  <script src="leaflet-hash.js"></script>
</head>

<body>
<div id="map"></div>
<script type="text/javascript">

  var roadSizes = {
    "highway": "7px",
    "major_road": "3px",
    "minor_road": "1px",
    "rail": "0px",
    "path": "0.5px"
  };

  var roadColor = {
    "highway": "#F78545",
    "major_road": "#FFCD2F",
    "minor_road": "#707070",
    "rail": "orange",
    "path": "white"
  };

  //To Do, add labels
  // new L.TileLayer.d3_geoJSON("http://tile.openstreetmap.us/vectiles-skeletron/{z}/{x}/{y}.json", {
  //   text:'hello',
  //   href: function(d) { return '#' + d.geometry.coordinates[0]}
  // }).addTo(map)

  var land = new L.TileLayer.d3_geoJSON("http://tile.openstreetmap.us/vectiles-land-usages/{z}/{x}/{y}.json", {
    class: function(d) {return 'landuse ' + d.properties.kind; console.log(d.properties.kind)},
    style: function(d) {return}
  })

  var water = new L.TileLayer.d3_geoJSON("http://tile.openstreetmap.us/vectiles-water-areas/{z}/{x}/{y}.json", {
    class: "water"
  })

  var building = new L.TileLayer.d3_geoJSON("http://tile.openstreetmap.us/vectiles-buildings/{z}/{x}/{y}.json", {
    class: "building"
  })

  var road = new L.TileLayer.d3_geoJSON("http://tile.openstreetmap.us/vectiles-highroad/{z}/{x}/{y}.json", {
    class: "road",
    style: function(d) { return "stroke-width: " + roadSizes[d.properties.kind] +"; stroke: " + roadColor[d.properties.kind]},
  })

  // Add a fake GeoJSON line to coerce Leaflet into creating the <svg> tag that d3_geoJson needs
  var dummy = new L.geoJson({"type": "LineString","coordinates":[[0,0],[0,0]]})

  var map = L.map('map', {
        center: [37.7837,-122.4166],
        zoom: 16,
        minZoom:13,
        layers: [land, water, building, road, dummy]
      });
  
  var hash = new L.Hash(map)

  var baseLayers = {};

  var overlays = {
    "Land": land,
    "Water": water,
    "Buildings": building,
    "Roads": road
  };

  L.control.layers(baseLayers, overlays).addTo(map);

  map.on('moveend',runFoursquare)
  runFoursquare()

</script>
</body>
</html>
